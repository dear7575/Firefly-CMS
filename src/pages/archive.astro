---
export const prerender = false;
import ArchivePanel from "@components/interactive/ArchivePanel.svelte";
import I18nKey from "@i18n/i18nKey";
import { i18n } from "@i18n/translation";
import MainGridLayout from "@layouts/MainGridLayout.astro";
import { getSortedPostsList } from "@/utils/content-utils";
import { fetchSiteSettings } from "@/services/siteSettings";

// 获取动态配置
let dynamicSettings: Record<string, any> = {};
try {
	dynamicSettings = await fetchSiteSettings();
} catch (error) {
	console.warn("无法获取动态配置，使用静态配置");
}

// 检查归档功能是否启用（动态配置优先）
const featureArchive = dynamicSettings.feature_archive ?? true;
if (!featureArchive) {
	return Astro.redirect("/404");
}

const sortedPostsList = await getSortedPostsList();
---

<MainGridLayout title={i18n(I18nKey.archive)}>
  <ArchivePanel sortedPosts={sortedPostsList} client:only="svelte" />
</MainGridLayout>
