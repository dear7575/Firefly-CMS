---
export const prerender = false;
import AdminLayout from "../../layouts/AdminLayout.astro";
import { siteConfig } from "../../config";
import I18nKey from "@/i18n/i18nKey";
import { i18n } from "@/i18n/translation";
import { getApiUrl } from "@/utils/api-utils";
const API_URL = getApiUrl();

const isEdit = false;
---

<AdminLayout title={`${i18n(I18nKey.adminNewPost)} - ${siteConfig.title}`}>
    <div class="h-full flex flex-col overflow-y-auto lg:overflow-hidden">
        <!-- Header -->
        <div
            class="sticky top-0 z-20 px-4 sm:px-6 lg:px-8 py-3 sm:py-4 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between shadow-sm"
            data-editor-header
        >
            <div class="flex items-center gap-4">
                <a
                    href="/admin/posts"
                    data-admin-back="posts"
                    class="p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors text-zinc-500"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"></path>
                    </svg>
                </a>
                <h1
                    class="text-lg sm:text-xl font-bold text-zinc-900 dark:text-zinc-100"
                >
                    {i18n(I18nKey.adminNewPost)}
                </h1>
            </div>
            <div class="flex items-center gap-3">
                <button
                    type="button"
                    id="openEditorImagePicker"
                    class="px-4 py-2 rounded-xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-sm text-zinc-700 dark:text-zinc-300 font-medium transition-all"
                >
                    插入 图片
                </button>
                <button
                    id="saveBtn"
                    class="bg-[var(--primary)] dark:bg-zinc-800 hover:opacity-90 dark:hover:bg-zinc-700 text-white dark:text-zinc-100 px-4 sm:px-6 py-2 rounded-xl font-bold transition-all shadow-md hover:shadow-lg active:scale-95 primary-glow"
                    data-publish-text={i18n(I18nKey.adminPostPublish)}
                    data-publishing-text={i18n(I18nKey.adminPostPublishing)}
                >
                    {i18n(I18nKey.adminPostPublish)}
                </button>
            </div>
        </div>

        <div
            class="flex-1 flex flex-col lg:flex-row lg:overflow-hidden min-h-0"
        >
            <!-- Left Side: Editor -->
            <div
                class="flex-1 min-w-0 min-h-[70vh] sm:min-h-[72vh] lg:min-h-0 flex flex-col p-4 sm:p-6 lg:p-8 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 lg:border-b-0 lg:border-r"
            >
                <input
                    type="text"
                    id="title"
                    placeholder={i18n(I18nKey.adminPostTitlePlaceholder)}
                    class="admin-input flex-shrink-0 text-xl sm:text-2xl lg:text-3xl font-bold mb-4 px-4 py-3 rounded-xl bg-zinc-50 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 placeholder:text-zinc-400 dark:placeholder:text-zinc-500 text-zinc-900 dark:text-zinc-100 transition-all"
                />
                <div
                    id="vditor"
                    class="flex-1 min-h-0 border-none shadow-none overflow-hidden"
                >
                </div>
            </div>

            <!-- Right Side: Settings -->
            <div
                class="w-full lg:w-80 lg:flex-shrink-0 lg:min-h-0 lg:overflow-y-auto bg-zinc-50/50 dark:bg-zinc-950/50 p-4 sm:p-6 lg:p-6 custom-scrollbar backdrop-blur-sm border-t border-zinc-200 dark:border-zinc-800 lg:border-t-0"
            >
                <div class="space-y-8">
                    <!-- Basic Info Section -->
                    <section>
                        <h3
                            class="text-xs font-bold uppercase tracking-widest text-zinc-400 mb-4 flex items-center gap-2"
                        >
                            <svg
                                class="w-1 h-1 rounded-full bg-zinc-400"
                                fill="currentColor"
                                viewBox="0 0 4 4"
                            >
                                <circle cx="2" cy="2" r="2"></circle>
                            </svg>
                            {i18n(I18nKey.adminSectionBasicInfo)}
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >{i18n(I18nKey.adminPostSlug)}</label
                                >
                                <input
                                    id="slug"
                                    type="text"
                                    placeholder={i18n(
                                        I18nKey.adminPostSlugPlaceholder,
                                    )}
                                    class="admin-input"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >{
                                        i18n(I18nKey.adminPostCategoryLabel)
                                    }</label
                                >
                                <div
                                    class="custom-select"
                                    id="categorySelector"
                                >
                                    <div
                                        class="custom-select-trigger"
                                        id="categorySelectorTrigger"
                                    >
                                        <span
                                            class="custom-select-value placeholder"
                                            id="categoryValue"
                                            data-placeholder={i18n(
                                                I18nKey.adminPostCategoryPlaceholder,
                                            )}
                                        >
                                            {
                                                i18n(
                                                    I18nKey.adminPostCategoryPlaceholder,
                                                )
                                            }
                                        </span>
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="custom-select-arrow"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                    <div
                                        class="custom-select-dropdown hidden"
                                        id="categoryDropdown"
                                    >
                                        <div class="custom-select-search">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-4 w-4 text-zinc-400"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                                ></path>
                                            </svg>
                                            <input
                                                type="text"
                                                id="categorySearch"
                                                placeholder="搜索分类..."
                                            />
                                        </div>
                                        <div
                                            class="custom-select-options"
                                            id="categoryOptions"
                                        >
                                            <!-- 分类选项会通过 JS 动态填充 -->
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="category" value="" />
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >{i18n(I18nKey.adminPostTags)}</label
                                >
                                <div id="tagsContainer" class="tags-selector">
                                    <span class="text-sm text-zinc-400 italic"
                                        >{i18n(I18nKey.adminLoading)}</span
                                    >
                                </div>
                                <p class="text-xs text-zinc-400 mt-2">
                                    {i18n(I18nKey.adminPostTagsHint)}
                                </p>
                                <input
                                    type="hidden"
                                    id="selectedTags"
                                    value=""
                                />
                            </div>
                        </div>
                    </section>

                    <!-- Media Section -->
                    <section>
                        <h3
                            class="text-xs font-bold uppercase tracking-widest text-zinc-400 mb-4 flex items-center gap-2"
                        >
                            <svg
                                class="w-1 h-1 rounded-full bg-zinc-400"
                                fill="currentColor"
                                viewBox="0 0 4 4"
                            >
                                <circle cx="2" cy="2" r="2"></circle>
                            </svg>
                            {i18n(I18nKey.adminSectionAppearance)}
                        </h3>
                        <div>
                            <label
                                class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                >{i18n(I18nKey.adminPostImage)}</label
                            >
                            <div class="flex items-center gap-2">
                                <input
                                    id="image"
                                    type="text"
                                    placeholder={i18n(
                                        I18nKey.adminPostImagePlaceholder,
                                    )}
                                    class="admin-input flex-1"
                                />
                                <button
                                    type="button"
                                    id="openCoverPicker"
                                    class="h-[46px] px-3 rounded-xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-800 hover:border-zinc-300 dark:hover:border-zinc-700 hover:shadow-sm text-zinc-700 dark:text-zinc-300 text-sm font-medium transition-all flex items-center justify-center"
                                >
                                    从媒体库
                                </button>
                            </div>
                            <div
                                id="imagePreview"
                                class="mt-2 w-full aspect-video rounded-lg overflow-hidden border border-zinc-200 dark:border-zinc-800 bg-zinc-100 dark:bg-zinc-900 hidden"
                            >
                                <img
                                    src=""
                                    alt="Preview"
                                    class="w-full h-full object-cover"
                                />
                            </div>
                        </div>
                    </section>

                    <!-- Advanced Section -->
                    <section>
                        <h3
                            class="text-xs font-bold uppercase tracking-widest text-zinc-400 mb-4 flex items-center gap-2"
                        >
                            <svg
                                class="w-1 h-1 rounded-full bg-zinc-400"
                                fill="currentColor"
                                viewBox="0 0 4 4"
                            >
                                <circle cx="2" cy="2" r="2"></circle>
                            </svg>
                            {i18n(I18nKey.adminSectionAdvanced)}
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >{i18n(I18nKey.adminPostPassword)}</label
                                >
                                <div class="relative">
                                    <input
                                        id="password"
                                        type="password"
                                        placeholder={i18n(
                                            I18nKey.adminPostPasswordPlaceholder,
                                        )}
                                        class="admin-input pr-12"
                                    />
                                    <button
                                        type="button"
                                        id="password-toggle"
                                        class="admin-password-toggle"
                                        aria-label="显示密码"
                                        title="显示密码"
                                    >
                                        <svg
                                            data-eye="show"
                                            class="w-5 h-5"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="1.8"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <path
                                                d="M2.5 12s3.5-6.5 9.5-6.5 9.5 6.5 9.5 6.5-3.5 6.5-9.5 6.5S2.5 12 2.5 12z"
                                            ></path>
                                            <circle cx="12" cy="12" r="3.5"
                                            ></circle>
                                        </svg>
                                        <svg
                                            data-eye="hide"
                                            class="w-5 h-5 hidden"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="1.8"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            <path d="M3 3l18 18"></path>
                                            <path
                                                d="M10.5 5.2A9.9 9.9 0 0 1 12 5c6 0 9.5 7 9.5 7a18.2 18.2 0 0 1-4 4.8"
                                            ></path>
                                            <path
                                                d="M6.4 6.4A18.4 18.4 0 0 0 2.5 12s3.5 6.5 9.5 6.5c1.6 0 3-.4 4.2-1"
                                            ></path>
                                            <path
                                                d="M9.9 9.9a3.5 3.5 0 0 0 4.2 4.2"
                                            ></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >是否置顶</label
                                >
                                <button
                                    type="button"
                                    class="pinned-toggle"
                                    id="pinnedToggle"
                                    aria-pressed="false"
                                >
                                    <span
                                        class="pinned-toggle-track"
                                        id="pinnedToggleTrack"
                                    >
                                        <span
                                            class="pinned-toggle-handle"
                                            id="pinnedToggleHandle"></span>
                                    </span>
                                </button>
                            </div>
                            <!-- 置顶排序 -->
                            <div id="pinOrderContainer" class="hidden">
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >{i18n(I18nKey.adminPostPinOrder)}</label
                                >
                                <input
                                    id="pinOrder"
                                    type="number"
                                    min="0"
                                    value="0"
                                    placeholder={i18n(
                                        I18nKey.adminPostPinOrderPlaceholder,
                                    )}
                                    class="admin-input"
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >发布状态</label
                                >
                                <div class="custom-select" id="statusSelector">
                                    <div
                                        class="custom-select-trigger"
                                        id="statusTrigger"
                                    >
                                        <span
                                            class="custom-select-value"
                                            id="statusValue">保存草稿</span
                                        >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            class="custom-select-arrow"
                                            fill="none"
                                            viewBox="0 0 24 24"
                                            stroke="currentColor"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                    <div
                                        class="custom-select-dropdown hidden"
                                        id="statusDropdown"
                                    >
                                        <div
                                            class="custom-select-options"
                                            id="statusOptions"
                                        >
                                            <div
                                                class="custom-select-option"
                                                data-value="published"
                                            >
                                                <span
                                                    class="custom-select-option-name"
                                                    >{
                                                        i18n(
                                                            I18nKey.adminPostPublish,
                                                        )
                                                    }</span
                                                >
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    class="custom-select-option-check"
                                                    fill="none"
                                                    viewBox="0 0 24 24"
                                                    stroke="currentColor"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M5 13l4 4L19 7"
                                                    ></path>
                                                </svg>
                                            </div>
                                            <div
                                                class="custom-select-option selected"
                                                data-value="draft"
                                            >
                                                <span
                                                    class="custom-select-option-name"
                                                    >保存草稿</span
                                                >
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    class="custom-select-option-check"
                                                    fill="none"
                                                    viewBox="0 0 24 24"
                                                    stroke="currentColor"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M5 13l4 4L19 7"
                                                    ></path>
                                                </svg>
                                            </div>
                                            <div
                                                class="custom-select-option"
                                                data-value="scheduled"
                                            >
                                                <span
                                                    class="custom-select-option-name"
                                                    >定时发布</span
                                                >
                                                <svg
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    class="custom-select-option-check"
                                                    fill="none"
                                                    viewBox="0 0 24 24"
                                                    stroke="currentColor"
                                                >
                                                    <path
                                                        stroke-linecap="round"
                                                        stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M5 13l4 4L19 7"
                                                    ></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <input
                                    type="hidden"
                                    id="statusSelect"
                                    value="draft"
                                />
                                <p class="text-xs text-zinc-400 mt-2">
                                    选择文章发布方式，定时发布需要设置具体时间。
                                </p>
                            </div>
                            <div>
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >自定义发布时间</label
                                >
                                <div class="flatpickr-wrapper">
                                    <div class="flatpickr-input-group">
                                        <input
                                            type="text"
                                            id="publishedAt"
                                            class="admin-input flatpickr-input"
                                            placeholder="点击选择时间"
                                            readonly
                                        />
                                        <div class="flatpickr-input-icon">
                                            <svg
                                                class="w-5 h-5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="1.5"
                                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                                ></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="flatpickr-shortcuts">
                                        <button
                                            type="button"
                                            class="shortcut-btn"
                                            data-action="now"
                                            data-target="publishedAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                                ></path></svg
                                            >
                                            现在
                                        </button>
                                        <button
                                            type="button"
                                            class="shortcut-btn"
                                            data-action="tomorrow"
                                            data-target="publishedAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                                ></path></svg
                                            >
                                            明天
                                        </button>
                                        <button
                                            type="button"
                                            class="shortcut-btn shortcut-btn-clear"
                                            data-action="clear"
                                            data-target="publishedAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M6 18L18 6M6 6l12 12"
                                                ></path></svg
                                            >
                                            清除
                                        </button>
                                    </div>
                                </div>
                                <p class="text-xs text-zinc-400 mt-2">
                                    可选：用于回填历史文章或自定义发布时间。
                                </p>
                            </div>
                            <div id="scheduledWrapper" class="hidden">
                                <label
                                    class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                                    >定时发布时间</label
                                >
                                <div class="flatpickr-wrapper">
                                    <div class="flatpickr-input-group">
                                        <input
                                            type="text"
                                            id="scheduledAt"
                                            class="admin-input flatpickr-input"
                                            placeholder="点击选择时间"
                                            readonly
                                        />
                                        <div class="flatpickr-input-icon">
                                            <svg
                                                class="w-5 h-5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="1.5"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                                ></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="flatpickr-shortcuts">
                                        <button
                                            type="button"
                                            class="shortcut-btn"
                                            data-action="now"
                                            data-target="scheduledAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                                ></path></svg
                                            >
                                            现在
                                        </button>
                                        <button
                                            type="button"
                                            class="shortcut-btn"
                                            data-action="tomorrow"
                                            data-target="scheduledAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                                                ></path></svg
                                            >
                                            明天
                                        </button>
                                        <button
                                            type="button"
                                            class="shortcut-btn"
                                            data-action="week"
                                            data-target="scheduledAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                                                ></path></svg
                                            >
                                            一周后
                                        </button>
                                        <button
                                            type="button"
                                            class="shortcut-btn shortcut-btn-clear"
                                            data-action="clear"
                                            data-target="scheduledAt"
                                        >
                                            <svg
                                                class="w-3.5 h-3.5"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                ><path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M6 18L18 6M6 6l12 12"
                                                ></path></svg
                                            >
                                            清除
                                        </button>
                                    </div>
                                </div>
                                <p class="text-xs text-amber-500 mt-2">
                                    启用定时发布后将于指定时间自动发布。
                                </p>
                            </div>
                        </div>
                    </section>

                    <section class="mb-4">
                        <label
                            class="block text-xs font-bold text-zinc-500 mb-2 uppercase tracking-tight"
                            >{i18n(I18nKey.adminPostDescription)}</label
                        >
                        <textarea
                            id="description"
                            rows="3"
                            placeholder={i18n(
                                I18nKey.adminPostDescriptionPlaceholder,
                            )}
                            class="admin-input resize-none"></textarea>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- 媒体库选择器 -->
    <div
        id="mediaPickerModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
    >
        <div
            class="bg-white dark:bg-zinc-900 rounded-2xl w-full max-w-5xl border border-zinc-200 dark:border-zinc-800 shadow-2xl overflow-hidden"
        >
            <div
                class="px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between"
            >
                <div>
                    <h3
                        class="text-lg font-bold text-zinc-900 dark:text-zinc-100"
                    >
                        选择图片
                    </h3>
                    <p class="text-xs text-zinc-500">
                        从媒体库选择插入或作为封面
                    </p>
                </div>
                <button
                    id="mediaPickerClose"
                    class="w-9 h-9 rounded-xl bg-zinc-100 dark:bg-zinc-800 text-zinc-500 hover:bg-zinc-200 dark:hover:bg-zinc-700 flex items-center justify-center"
                >
                    <svg
                        class="w-5 h-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path></svg
                    >
                </button>
            </div>
            <div class="p-4 flex flex-col gap-3">
                <div
                    class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between"
                >
                    <div class="relative w-full sm:w-72">
                        <input
                            id="mediaPickerSearch"
                            type="text"
                            placeholder="搜索图片..."
                            class="w-full px-4 h-10 pl-10 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 text-sm focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent outline-none transition-all"
                        />
                        <svg
                            class="w-5 h-5 text-zinc-400 absolute left-3 top-1/2 -translate-y-1/2"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                            ></path></svg
                        >
                    </div>
                    <div class="text-xs text-zinc-500" id="mediaPickerCount">
                        0
                    </div>
                </div>
                <div
                    id="mediaPickerGrid"
                    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 min-h-[240px]"
                >
                    <div
                        class="col-span-full text-center text-sm text-zinc-500 py-10"
                    >
                        加载中...
                    </div>
                </div>
                <div
                    class="flex items-center justify-between text-sm text-zinc-500"
                >
                    <button
                        id="mediaPickerPrev"
                        class="px-3 py-1.5 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"
                        >上一页</button
                    >
                    <span id="mediaPickerPage">1/1</span>
                    <button
                        id="mediaPickerNext"
                        class="px-3 py-1.5 rounded-lg bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"
                        >下一页</button
                    >
                </div>
            </div>
        </div>
    </div>
</AdminLayout>

<script>
    import { initPostEditor } from "../../scripts/admin-post-editor";
    document.addEventListener("astro:page-load", () => {
        const vditorEl = document.getElementById("vditor");
        // 检查是否在新建文章页面
        if (
            window.location.pathname.includes("/admin/new") &&
            vditorEl &&
            !vditorEl.dataset.initialized
        ) {
            vditorEl.dataset.initialized = "true";
            window._currentEditor = initPostEditor();
        }
    });
</script>
