---
import {backgroundWallpaper, siteConfig} from "@/config";
import "@/styles/layout-styles.css";
import {ClientRouter} from 'astro:transitions';
import "@/styles/waves.css";
import I18nKey from "@/i18n/i18nKey";
import {i18n} from "@/i18n/translation";
import {getBackgroundImages} from "@/utils/layout-utils";
import ImageWrapper from "@/components/misc/ImageWrapper.astro";
import {fetchSiteSettings} from "@/services/siteSettings";
import FontManager from "@components/interactive/FontManager.astro";

interface Props {
    title: string;
    activeMenu?: string;
    hideNav?: boolean;  // 用于登录页面等不需要导航的页面
}

const {title, activeMenu = "dashboard", hideNav = false} = Astro.props;
const pageHeading = title.split(" - ")[0] || title;
// console.log(`[AdminLayout] Rendering with activeMenu: '${activeMenu}'`);

// 尝试从 API 获取动态配置
let dynamicSettings: Record<string, any> = {};
try {
    dynamicSettings = await fetchSiteSettings();
} catch (error) {
    console.warn("无法获取动态配置，使用静态配置");
}

// 获取站点标题（动态配置优先）
const adminSiteTitle =
    dynamicSettings.brand_navbar_title ||
    dynamicSettings.site_title ||
    siteConfig.navbar?.title ||
    siteConfig.title;

// 处理页面标题：将静态的 siteConfig.title 替换为动态标题
const pageTitle = title.replace(siteConfig.title, adminSiteTitle).replace('Firefly', adminSiteTitle);

const configHue = dynamicSettings.theme_hue ?? siteConfig.themeColor.hue;

import {getApiUrl} from "@/utils/api-utils";

// SSR 使用的 API 地址
const API_URL = getApiUrl();
// 客户端使用的 API 地址
const PUBLIC_API_URL = import.meta.env.PUBLIC_API_URL;

// 获取背景图片配置（用于登录页面）
const backgroundImages = getBackgroundImages();

// 获取波浪效果配置
const wavesConfig = backgroundWallpaper.banner?.waves?.enable;
const wavesEnabledOnDesktop = typeof wavesConfig === "object" ? wavesConfig.desktop : wavesConfig;
const wavesEnabledOnMobile = typeof wavesConfig === "object" ? wavesConfig.mobile : wavesConfig;
const performanceConfig = backgroundWallpaper.banner?.waves?.performance;
const waveQuality = performanceConfig?.quality || "high";
const hardwareAcceleration = performanceConfig?.hardwareAcceleration ?? true;

// Admin i18n translations for inline scripts
const adminI18n = {
    viewSite: i18n(I18nKey.home),
    logout: i18n(I18nKey.adminLogout),
    postManagement: i18n(I18nKey.adminPostManagement),
    newPost: i18n(I18nKey.adminNewPost),
    draft: i18n(I18nKey.adminPostDraft),
    protected: i18n(I18nKey.adminPostProtected),
    public: i18n(I18nKey.adminPostPublic),
    pinned: i18n(I18nKey.pinned),
    uncategorized: i18n(I18nKey.adminPostUncategorized),
    empty: i18n(I18nKey.adminPostEmpty),
    loadFailed: i18n(I18nKey.adminPostLoadFailed),
    adminLoading: i18n(I18nKey.adminLoading),
    confirmDelete: i18n(I18nKey.adminConfirmDelete),
    initSettingsConfirm: i18n(I18nKey.adminConfirmInitSettings),
    loginExpired: i18n(I18nKey.adminLoginExpired),
    deleteFailed: i18n(I18nKey.adminDeleteFailed),
    // 分页翻译
    paginationPrev: i18n(I18nKey.adminPaginationPrev),
    paginationNext: i18n(I18nKey.adminPaginationNext),
    paginationInfo: i18n(I18nKey.adminPaginationInfo),
    paginationPerPage: i18n(I18nKey.adminPaginationPerPage),
    // 分类页与通用文案
    add: i18n(I18nKey.adminAdd),
    edit: i18n(I18nKey.adminEdit),
    categories: i18n(I18nKey.categories),
    tags: i18n(I18nKey.tags),
    active: i18n(I18nKey.adminActive),
    disabled: i18n(I18nKey.adminDisabled),
    posts: i18n(I18nKey.adminPosts),
    adminPost: i18n(I18nKey.adminPost),
    adminSettings: i18n(I18nKey.adminSettings),
    noCategories: i18n(I18nKey.adminNoCategories),
    noCategoriesYet: i18n(I18nKey.adminNoCategoriesYet),
    categoryLoadFailed: i18n(I18nKey.adminCategoryLoadFailed),
    confirmDeleteCategory: i18n(I18nKey.adminConfirmDeleteCategory),
    saveFailed: i18n(I18nKey.adminSaveFailed),
    other: i18n(I18nKey.other),
    friends: i18n(I18nKey.friends),
    socialLink: i18n(I18nKey.adminSocialLink),
    socialLinksEmpty: i18n(I18nKey.adminSocialEmpty),
    socialLinksFailed: i18n(I18nKey.adminSocialLoadFailed),
    socialBadgeText: i18n(I18nKey.adminSocialBadgeShowName),
    socialBadgeIconOnly: i18n(I18nKey.adminSocialBadgeIconOnly),
    socialShowName: i18n(I18nKey.adminSocialShowName),
    confirmDeleteSocialLink: i18n(I18nKey.adminConfirmDeleteSocialLink),
    socialUrlInvalid: i18n(I18nKey.adminSocialUrlInvalid),
    backupTitle: i18n(I18nKey.adminBackupManagement),
    backupHint: i18n(I18nKey.adminManageBackups),
    backupExportAll: i18n(I18nKey.adminBackupExportAll),
    backupExportPosts: i18n(I18nKey.adminBackupExportPosts),
    backupImport: i18n(I18nKey.adminBackupImport),
    backupImportHint: i18n(I18nKey.adminBackupImportHint),
    backupSelectFile: i18n(I18nKey.adminBackupSelectFile),
    backupMerge: i18n(I18nKey.adminBackupMerge),
    backupMergeDesc: i18n(I18nKey.adminBackupMergeDesc),
    backupOverwrite: i18n(I18nKey.adminBackupOverwrite),
    backupImporting: i18n(I18nKey.adminBackupImporting),
    backupImportSuccess: i18n(I18nKey.adminBackupImportSuccess),
    backupImportFailed: i18n(I18nKey.adminBackupImportFailed),
    backupDownloadFailed: i18n(I18nKey.adminBackupDownloadFailed),
    backupNoFile: i18n(I18nKey.adminBackupNoFile),
    backupSummary: i18n(I18nKey.adminBackupSummary),
    backupExportHint: i18n(I18nKey.adminBackupExportHint),
    backupFileEmpty: i18n(I18nKey.adminBackupFileEmpty),
    backupImportConfirmMerge: i18n(I18nKey.adminBackupImportConfirmMerge),
    backupImportConfirmOverwrite: i18n(I18nKey.adminBackupImportConfirmOverwrite),
    backupStatImported: i18n(I18nKey.adminBackupStatImported),
    backupStatSkipped: i18n(I18nKey.adminBackupStatSkipped),
    backupStatErrors: i18n(I18nKey.adminBackupStatErrors),
    backupHistory: i18n(I18nKey.adminBackupHistory),
    backupHistoryHint: i18n(I18nKey.adminBackupHistoryHint),
    backupHistoryRefresh: i18n(I18nKey.adminBackupHistoryRefresh),
    backupHistoryLoading: i18n(I18nKey.adminBackupHistoryLoading),
    backupHistoryEmpty: i18n(I18nKey.adminBackupHistoryEmpty),
    backupHistoryLoadFailed: i18n(I18nKey.adminBackupHistoryLoadFailed),
    backupHistoryDownload: i18n(I18nKey.adminBackupHistoryDownload),
    backupHistoryDelete: i18n(I18nKey.adminBackupHistoryDelete),
    backupHistoryDeleteConfirm: i18n(I18nKey.adminBackupHistoryDeleteConfirm),
    backupHistoryDeleteSuccess: i18n(I18nKey.adminBackupHistoryDeleteSuccess),
    backupHistoryDeleteFailed: i18n(I18nKey.adminBackupHistoryDeleteFailed),
    backupHistoryType: i18n(I18nKey.adminBackupHistoryType),
    backupHistoryTypeFull: i18n(I18nKey.adminBackupHistoryTypeFull),
    backupHistoryTypePosts: i18n(I18nKey.adminBackupHistoryTypePosts),
    backupHistorySource: i18n(I18nKey.adminBackupHistorySource),
    backupHistorySourceAuto: i18n(I18nKey.adminBackupHistorySourceAuto),
    backupHistorySourceManual: i18n(I18nKey.adminBackupHistorySourceManual),
    backupHistorySize: i18n(I18nKey.adminBackupHistorySize),
    backupHistoryTime: i18n(I18nKey.adminBackupHistoryTime),
    all: i18n(I18nKey.bangumiFilterAll),
    contentEmpty: i18n(I18nKey.adminContentEmpty),
    delete: i18n(I18nKey.adminDelete),
    sortOrder: i18n(I18nKey.adminSortOrder),
};

const normalizeMenuPath = (path) => {
    if (!path) return "/";
    let normalized = path.split("?")[0].split("#")[0];
    if (normalized.length > 1 && normalized.endsWith("/")) {
        normalized = normalized.slice(0, -1);
    }
    return normalized || "/";
};

// Menu items
const menuItems = [
    {
        id: "dashboard",
        label: i18n(I18nKey.adminDashboard),
        icon: "M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6",
        href: "/admin"
    },
    {
        id: "posts",
        label: i18n(I18nKey.adminPostManagement),
        icon: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",
        href: "/admin/posts"
    },
    {
        id: "scheduled",
        label: i18n(I18nKey.adminScheduledManagement),
        icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
        href: "/admin/scheduled"
    },
    {
        id: "categories",
        label: i18n(I18nKey.adminCategoryManagement),
        icon: "M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10",
        href: "/admin/categories"
    },
    {
        id: "tags",
        label: i18n(I18nKey.adminTagManagement),
        icon: "M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z",
        href: "/admin/tags"
    },
    {
        id: "friends",
        label: i18n(I18nKey.adminFriendManagement),
        icon: "M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1",
        href: "/admin/friends"
    },
    {
        id: "social-links",
        label: i18n(I18nKey.adminSocialManagement),
        icon: "M21 8V7a2 2 0 00-2-2H5a2 2 0 00-2 2v1m18 0l-8.228 5.485a2 2 0 01-2.344 0L3 8m18 0v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8",
        href: "/admin/social-links"
    },
    {
        id: "media",
        label: "文件管理",
        icon: "M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z",
        href: "/admin/media"
    },
    {
        id: "announcement",
        label: i18n(I18nKey.adminAnnouncementManagement),
        icon: "M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z",
        href: "/admin/announcement"
    },
    {
        id: "logs",
        label: i18n(I18nKey.adminLogManagement),
        icon: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01",
        href: "/admin/logs"
    },
    {
        id: "backup",
        label: i18n(I18nKey.adminBackupManagement),
        icon: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
        href: "/admin/backup"
    },
    {
        id: "settings",
        label: i18n(I18nKey.adminSystemManagement),
        icon: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",
        href: "/admin/settings"
    },
];

const adminMenuMap = Object.fromEntries(
    menuItems.map((item) => [normalizeMenuPath(item.href), item.label])
);

const adminMenuIcons = Object.fromEntries(
    menuItems.map((item) => [normalizeMenuPath(item.href), item.icon])
);
---

<!doctype html>
<html
        lang="en"
        class="text-zinc-900 dark:text-zinc-100"
        style={`--configHue: ${configHue}; --hue: ${configHue}; --primary: oklch(0.70 0.14 ${configHue}); --primary-light: oklch(0.75 0.14 ${configHue}); --primary-dark: oklch(0.65 0.14 ${configHue}); --page-bg: oklch(0.97 0.012 ${configHue}); --page-bg-dark: oklch(0.16 0.015 ${configHue}); --card-bg: white; --card-bg-dark: oklch(0.23 0.015 ${configHue}); --btn-bg: oklch(0.95 0.025 ${configHue}); --btn-bg-hover: oklch(0.9 0.05 ${configHue}); --btn-bg-dark: oklch(0.33 0.035 ${configHue}); --btn-bg-hover-dark: oklch(0.38 0.04 ${configHue}); --sidebar-bg: oklch(0.98 0.008 ${configHue}); --sidebar-bg-dark: oklch(0.18 0.012 ${configHue}); --primary-rgb: 79, 70, 229;`}
>
<head>
    <ClientRouter/>
    <!-- 顶部加载进度条 -->
    <style is:inline>
        #page-progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary, #6366f1);
            z-index: 99999;
            transition: width 0.2s ease;
        }

        #page-progress-bar.loading {
            animation: progress-loading 1.5s ease-in-out infinite;
        }

        @keyframes progress-loading {
            0% {
                width: 0;
            }
            50% {
                width: 70%;
            }
            100% {
                width: 85%;
            }
        }

        #page-progress-bar.done {
            width: 100%;
            opacity: 0;
            transition: width 0.2s ease, opacity 0.3s ease 0.2s;
        }
    </style>
    <script is:inline>
        // 创建进度条元素
        (function () {
            if (!document.getElementById('page-progress-bar')) {
                var bar = document.createElement('div');
                bar.id = 'page-progress-bar';
                document.documentElement.appendChild(bar);
            }
        })();

        // 监听 Astro 导航事件
        document.addEventListener('astro:before-preparation', function () {
            var bar = document.getElementById('page-progress-bar');
            if (bar) {
                bar.classList.remove('done');
                bar.classList.add('loading');
                bar.style.width = '0';
                bar.style.opacity = '1';
            }
        });

        document.addEventListener('astro:page-load', function () {
            var bar = document.getElementById('page-progress-bar');
            if (bar) {
                bar.classList.remove('loading');
                bar.classList.add('done');
                // 重置状态 - 等待透明度过渡完成后再重置
                setTimeout(function () {
                    bar.classList.remove('done');
                    // 临时禁用过渡，避免看到进度条缩回
                    bar.style.transition = 'none';
                    bar.style.width = '0';
                    bar.style.opacity = '1';
                    // 强制重绘后恢复过渡
                    bar.offsetHeight;
                    bar.style.transition = '';
                }, 600);
            }
        });
    </script>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{pageTitle}</title>
    <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
    <script is:inline define:vars={{PUBLIC_API_URL, adminI18n, adminMenuMap, adminMenuIcons}}>
        window.API_URL = PUBLIC_API_URL;
        window.adminI18n = adminI18n;
        window.adminMenuMap = adminMenuMap || {};
        window.adminMenuIcons = adminMenuIcons || {};
    </script>
    <script>
        import { initAdminCore } from "../scripts/admin-core";
        import { initAdminUI } from "../scripts/admin-ui";

        // Initialize core and UI
        initAdminCore();
        initAdminUI();
    </script>
    <FontManager/>
    <style is:global>
        @import "../styles/admin-custom.css";
    </style>
</head>
<body
        class="min-h-screen font-sans"
        data-admin-layout
>
{hideNav ? (
        <div class="min-h-screen relative overflow-hidden">
            <!-- 背景图片 -->
            <div class="absolute inset-0 z-0">
                <!-- Mobile background -->
                <ImageWrapper
                        alt="Mobile background"
                        class="block lg:hidden object-cover h-full w-full"
                        src={typeof backgroundImages.mobile === 'string' ? backgroundImages.mobile : (typeof backgroundImages.desktop === 'string' ? backgroundImages.desktop : '')}
                        position={backgroundWallpaper.banner?.position}
                />
                <!-- Desktop background -->
                <ImageWrapper
                        alt="Desktop background"
                        class="hidden lg:block object-cover h-full w-full"
                        src={typeof backgroundImages.desktop === 'string' ? backgroundImages.desktop : (typeof backgroundImages.mobile === 'string' ? backgroundImages.mobile : '')}
                        position={backgroundWallpaper.banner?.position}
                />
                <!-- 暗色遮罩层 -->
                <div class="absolute inset-0 bg-black/30 dark:bg-black/50"></div>
            </div>

            <!-- 波浪效果 -->
            {(wavesEnabledOnDesktop || wavesEnabledOnMobile) && (
                    <div class={`waves absolute bottom-0 h-[15vh] max-h-[9.375rem] min-h-[3.125rem] w-full z-10
                    ${!wavesEnabledOnMobile ? 'hidden' : ''} ${!wavesEnabledOnDesktop ? 'md:hidden' : ''} ${wavesEnabledOnDesktop ? 'md:block' : ''}`}
                         data-wave-quality={waveQuality}
                         data-hardware-acceleration={hardwareAcceleration}>
                        <svg
                                class="waves"
                                xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink"
                                viewBox="0 20 150 32"
                                preserveAspectRatio="none"
                                shape-rendering={waveQuality === 'low' ? 'optimizeSpeed' : 'auto'}
                                style="transform: translateZ(0); backface-visibility: hidden;"
                        >
                            <defs>
                                <path
                                        id="admin-gentle-wave"
                                        d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v48h-352z"
                                />
                            </defs>
                            <g class="parallax" style="transform: translateZ(0);">
                                <use
                                        xlink:href="#admin-gentle-wave"
                                        x="48"
                                        y="0"
                                        class="opacity-25 fill-zinc-100 dark:fill-zinc-950"
                                        style={`animation-delay: -2s; animation-duration: ${waveQuality === 'low' ? '10s' : waveQuality === 'medium' ? '8s' : '7s'};`}
                                />
                                <use
                                        xlink:href="#admin-gentle-wave"
                                        x="48"
                                        y="3"
                                        class="opacity-50 fill-zinc-100 dark:fill-zinc-950"
                                        style={`animation-delay: -3s; animation-duration: ${waveQuality === 'low' ? '15s' : waveQuality === 'medium' ? '12s' : '10s'};`}
                                />
                                <use
                                        xlink:href="#admin-gentle-wave"
                                        x="48"
                                        y="5"
                                        class="opacity-75 fill-zinc-100 dark:fill-zinc-950"
                                        style={`animation-delay: -4s; animation-duration: ${waveQuality === 'low' ? '20s' : waveQuality === 'medium' ? '16s' : '13s'};`}
                                />
                                <use
                                        xlink:href="#admin-gentle-wave"
                                        x="48"
                                        y="7"
                                        class="fill-zinc-100 dark:fill-zinc-950"
                                        style={`animation-delay: -5s; animation-duration: ${waveQuality === 'low' ? '30s' : waveQuality === 'medium' ? '25s' : '20s'};`}
                                />
                            </g>
                        </svg>
                    </div>
            )}

            <div class="relative z-20">
                <slot/>
            </div>
        </div>
) : (
        <div class="flex h-screen overflow-hidden">
            <!-- Sidebar -->
            <aside
                    id="sidebar"
                    class="w-64 bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 flex flex-col transition-all duration-300 fixed lg:relative h-full z-40 -translate-x-full lg:translate-x-0"
            >
                <!-- Logo -->
                <div class="h-14 flex items-center px-6 border-b border-zinc-200 dark:border-zinc-800">
                    <a href="/admin" data-no-swup class="flex items-center gap-3 group sidebar-logo">
                        <div
                                class="w-8 h-8 rounded-xl bg-[var(--primary)] text-white flex items-center justify-center font-bold shadow-lg group-hover:scale-110 transition-transform flex-shrink-0"
                        >
                            {adminSiteTitle.charAt(0).toUpperCase()}
                        </div>
                        <div class="sidebar-text">
                            <span class="font-bold text-base tracking-tight">{adminSiteTitle}</span>
                        </div>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 overflow-y-auto py-4 px-3">
                    <ul class="space-y-1">
                        {menuItems.map((item) => (
                                <li>
                                    <a
                                            href={item.href}
                                            data-no-swup
                                            title={item.label}
                                            class:list={[
                                                "flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all menu-item",
                                                activeMenu === item.id
                                                    ? "current-active-menu text-white shadow-lg"
                                                    : "text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 hover:text-zinc-900 dark:hover:text-zinc-100"
                                            ]}
                                            style={activeMenu === item.id ? `background: linear-gradient(135deg, oklch(0.70 0.14 ${configHue}) 0%, oklch(0.65 0.14 ${configHue}) 100%); background-color: oklch(0.70 0.14 ${configHue}); --primary: oklch(0.70 0.14 ${configHue});` : ''}
                                    >
                                        <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                class="h-5 w-5 flex-shrink-0"
                                                fill="none"
                                                viewBox="0 0 24 24"
                                                stroke="currentColor"
                                                stroke-width="2"
                                        >
                                            <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    d={item.icon}
                                            />
                                        </svg>
                                        <span class="sidebar-text whitespace-nowrap">{item.label}</span>
                                    </a>
                                </li>
                        ))}
                    </ul>
                </nav>

                <!-- Collapse Button -->
                <div class="hidden lg:block p-3 border-t border-zinc-200 dark:border-zinc-800">
                    <button
                            id="sidebarCollapseBtn"
                            class="w-full flex items-center justify-center gap-2 p-2.5 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors"
                            title="收起/展开菜单"
                    >
                        <!-- 展开状态图标：左双箭头 -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 collapse-icon-left" fill="none"
                             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                        </svg>
                        <!-- 折叠状态图标：右双箭头 -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 collapse-icon-right hidden"
                             fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>
                        </svg>
                        <span class="sidebar-text text-sm">收起菜单</span>
                    </button>
                </div>

            </aside>

            <!-- Sidebar Overlay (Mobile) -->
            <div
                    id="sidebarOverlay"
                    class="fixed inset-0 bg-black/50 z-30 lg:hidden hidden"
            ></div>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <!-- Top Bar -->
                <header class="h-14 bg-white dark:bg-zinc-900 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between px-4 lg:px-6 relative z-30">
                    <!-- Left: Mobile Menu Button + Page Title -->
                    <div class="flex items-center gap-2">
                        <!-- Mobile Menu Button -->
                        <button
                                id="menuToggle"
                                class="lg:hidden p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                 stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M4 6h16M4 12h16M4 18h16"/>
                            </svg>
                        </button>

                        <!-- Page Title (隐藏，防止与页签重复) -->
                        <h1 class="sr-only">
                            {pageHeading}
                        </h1>
                    </div>

                    <!-- Right Actions -->
                    <div class="flex items-center gap-3">
                        <!-- Theme Color Picker -->
                        <div class="relative">
                            <button
                                    id="themeColorBtn"
                                    class="p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors"
                                    title="主题色"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                            d="M12 22C6.49 22 2 17.51 2 12S6.49 2 12 2s10 4.04 10 9c0 3.31-2.69 6-6 6h-1.77c-.28 0-.5.22-.5.5c0 .12.05.23.13.33c.41.47.64 1.06.64 1.67A2.5 2.5 0 0 1 12 22m0-18c-4.41 0-8 3.59-8 8s3.59 8 8 8c.28 0 .5-.22.5-.5a.54.54 0 0 0-.14-.35c-.41-.46-.63-1.05-.63-1.65a2.5 2.5 0 0 1 2.5-2.5H16c2.21 0 4-1.79 4-4c0-3.86-3.59-7-8-7m-5.5 9a1.5 1.5 0 1 1 0-3a1.5 1.5 0 0 1 0 3m3-4a1.5 1.5 0 1 1 0-3a1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3a1.5 1.5 0 0 1 0 3m3 4a1.5 1.5 0 1 1 0-3a1.5 1.5 0 0 1 0 3"/>
                                </svg>
                            </button>
                            <!-- Theme Picker Dropdown -->
                            <div id="themePickerDropdown"
                                 class="absolute right-0 top-full mt-2 w-72 bg-white dark:bg-zinc-900 rounded-xl shadow-lg border border-zinc-200 dark:border-zinc-700 p-4 hidden z-50 transform transition-all origin-top-right">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center gap-2 relative pl-3 before:absolute before:left-0 before:top-1 before:bottom-1 before:w-1 before:bg-[var(--primary)] before:rounded-full">
                                        <span class="font-bold text-zinc-900 dark:text-zinc-100">主题色</span>
                                        <button id="resetThemeBtn"
                                                class="p-1 text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 transition-colors"
                                                title="重置">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                 viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <span id="currentHueDisplay"
                                          class="bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 px-2 py-1 rounded text-xs font-mono font-bold">165</span>
                                </div>
                                <div class="relative h-6 rounded-lg overflow-hidden w-full cursor-pointer group">
                                    <div class="absolute inset-0"
                                         style="background: linear-gradient(to right, oklch(0.75 0.12 0), oklch(0.75 0.12 30), oklch(0.75 0.12 60), oklch(0.75 0.12 90), oklch(0.75 0.12 120), oklch(0.75 0.12 150), oklch(0.75 0.12 180), oklch(0.75 0.12 210), oklch(0.75 0.12 240), oklch(0.75 0.12 270), oklch(0.75 0.12 300), oklch(0.75 0.12 330), oklch(0.75 0.12 360));"></div>
                                    <input
                                            type="range"
                                            id="headerHueSlider"
                                            min="0"
                                            max="360"
                                            step="5"
                                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                    />
                                    <div id="sliderThumb"
                                         class="absolute top-0 bottom-0 w-2 bg-white shadow-md pointer-events-none transform -translate-x-1/2 transition-transform duration-75 border border-zinc-200"
                                         style="left: 0%;"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Theme Toggle (Dark Mode) -->
                        <button
                                id="themeToggle"
                                class="p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors"
                                title="切换主题"
                        >
                            <!-- 亮色模式图标 (太阳) - material-symbols:wb-sunny-outline-rounded -->
                            <svg id="iconLight" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden"
                                 viewBox="0 0 24 24">
                                <path fill="currentColor"
                                      d="M12 17q-2.075 0-3.537-1.463T7 12t1.463-3.537T12 7t3.538 1.463T17 12t-1.463 3.538T12 17m0-2q1.25 0 2.125-.875T15 12t-.875-2.125T12 9t-2.125.875T9 12t.875 2.125T12 15m-7-4H1v2h4zm18 0h-4v2h4zM11 1v4h2V1zm0 18v4h2v-4zM6.35 7.75L3.87 5.27l1.41-1.41l2.48 2.48zm12.02 12.02l-2.48-2.48l1.4-1.4l2.49 2.47zM16.25 6.35l2.48-2.48l1.4 1.41l-2.47 2.48zm-12.02 12.02l2.48-2.48l1.4 1.4l-2.47 2.49z"/>
                            </svg>
                            <!-- 暗色模式图标 (月亮) - material-symbols:dark-mode-outline-rounded -->
                            <svg id="iconDark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden"
                                 viewBox="0 0 24 24">
                                <path fill="currentColor"
                                      d="M12 21q-3.75 0-6.375-2.625T3 12t2.625-6.375T12 3q.35 0 .688.025t.662.075q-1.025.725-1.638 1.888T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q1.375 0 2.525-.613T20.9 10.65q.05.325.075.662T21 12q0 3.75-2.625 6.375T12 21m0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19m-.25-6.75"/>
                            </svg>
                            <!-- 跟随系统图标 (自动) - material-symbols:brightness-auto-outline-rounded -->
                            <svg id="iconSystem" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden"
                                 viewBox="0 0 24 24">
                                <path fill="currentColor"
                                      d="M12 9a3 3 0 0 0-3 3a3 3 0 0 0 3 3a3 3 0 0 0 3-3a3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5a5 5 0 0 1 5-5a5 5 0 0 1 5 5a5 5 0 0 1-5 5m0-15a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 17a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1M5.64 5.64a1 1 0 0 1 1.41 0a1 1 0 0 1 0 1.41l-1.41 1.41a1 1 0 0 1-1.41 0a1 1 0 0 1 0-1.41zM18.36 18.36a1 1 0 0 1 1.41 0a1 1 0 0 1 0 1.41l-1.41 1.41a1 1 0 0 1-1.41 0a1 1 0 0 1 0-1.41zM2 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1m17 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1M5.64 18.36l1.41-1.41a1 1 0 0 1 1.41 0a1 1 0 0 1 0 1.41l-1.41 1.41a1 1 0 0 1-1.41 0a1 1 0 0 1 0-1.41M18.36 5.64l1.41-1.41a1 1 0 0 1 1.41 0a1 1 0 0 1 0 1.41l-1.41 1.41a1 1 0 0 1-1.41 0a1 1 0 0 1 0-1.41M12 10l.94 2.06L15 13l-2.06.94L12 16l-.94-2.06L9 13l2.06-.94z"/>
                            </svg>
                        </button>

                        <!-- User Dropdown -->
                        <div class="relative" id="userDropdownContainer">
                            <button
                                    id="userDropdownBtn"
                                    class="flex items-center gap-2 p-1.5 pr-3 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors"
                            >
                                <div id="userAvatarContainer"
                                     class="w-8 h-8 rounded-full bg-zinc-200 dark:bg-zinc-700 flex items-center justify-center overflow-hidden">
                                    <svg id="defaultAvatarIcon" xmlns="http://www.w3.org/2000/svg"
                                         class="h-4 w-4 text-zinc-500"
                                         fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <span id="usernameDisplay"
                                      class="text-sm font-medium text-zinc-700 dark:text-zinc-300 hidden sm:block">加载中...</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-zinc-400" fill="none"
                                     viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>

                            <!-- Dropdown Menu -->
                            <div id="userDropdownMenu"
                                 class="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-zinc-900 rounded-xl shadow-lg border border-zinc-200 dark:border-zinc-700 py-1 hidden z-50 opacity-0 transform scale-95 transition-all duration-150">
                                <div class="px-4 py-2 border-b border-zinc-100 dark:border-zinc-800">
                                    <p id="dropdownUsername"
                                       class="text-sm font-medium text-zinc-900 dark:text-zinc-100">管理员</p>
                                    <p class="text-xs text-zinc-500">管理员账户</p>
                                </div>
                                <a href="/" target="_blank"
                                   class="flex items-center gap-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                    {i18n(I18nKey.home)}
                                </a>
                                <button id="changePasswordBtn"
                                        class="w-full flex items-center gap-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                                    </svg>
                                    修改密码
                                </button>
                                <a href="/admin/settings/security"
                                   class="w-full flex items-center gap-2 px-4 py-2 text-sm text-zinc-700 dark:text-zinc-300 hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                    </svg>
                                    两步验证
                                </a>
                                <button id="logoutBtn"
                                        class="w-full flex items-center gap-2 px-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                         viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                    </svg>
                                    {i18n(I18nKey.adminLogout)}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                {!hideNav && (
                    <div
                            id="admin-tab-bar"
                            class="sticky top-14 z-20 px-4 lg:px-6 py-1 border-b border-zinc-200 dark:border-zinc-800 bg-white/95 dark:bg-zinc-900/95 flex items-center gap-3"
                    >
                        <div id="admin-tab-list" class="admin-tab-shell overflow-x-auto scrollbar-hide flex-1 min-w-0">
                            <span class="text-xs text-zinc-400 px-2 whitespace-nowrap">加载标签...</span>
                        </div>
                        <script is:inline>
                            (function () {
                                try {
                                    var snap = sessionStorage.getItem('firefly_admin_tab_snapshot');
                                    if (snap) {
                                        var list = document.getElementById('admin-tab-list');
                                        if (list) {
                                            list.innerHTML = snap;
                                        }
                                    }
                                } catch (err) {}
                            })();
                        </script>
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <button
                                    id="admin-tab-refresh"
                                    class="p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-200/70 dark:hover:bg-zinc-800/70 rounded-full transition"
                                    title="刷新当前标签"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                </svg>
                            </button>
                            <button
                                    id="admin-tab-close-others"
                                    class="p-2 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100 hover:bg-zinc-200/70 dark:hover:bg-zinc-800/70 rounded-full transition"
                                    title="关闭其他标签"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                     viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                )}

                <!-- Page Content -->
                <main class="flex-1 overflow-y-auto bg-zinc-100 dark:bg-zinc-950" data-no-swup
                      data-page-title={pageHeading}>
                    <slot/>
                </main>
            </div>
        </div>
)}

<script>
    import { initAdminTabs } from "../scripts/admin-tabs";
    initAdminTabs();
</script>

<!-- 全局美化弹框 -->
<div id="adminModal" class="fixed inset-0 bg-black/50 z-[200] hidden items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white dark:bg-zinc-900 rounded-2xl w-full max-w-sm shadow-2xl transform transition-all scale-95 opacity-0"
         id="adminModalContent">
        <div class="p-6 text-center">
            <!-- 图标 -->
            <div id="adminModalIcon" class="w-16 h-16 mx-auto mb-4 rounded-full flex items-center justify-center">
                <!-- 成功图标 -->
                <svg id="iconSuccess" class="hidden w-8 h-8 text-green-500" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <!-- 错误图标 -->
                <svg id="iconError" class="hidden w-8 h-8 text-red-500" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
                <!-- 警告图标 -->
                <svg id="iconWarning" class="hidden w-8 h-8 text-orange-500" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <!-- 信息图标 -->
                <svg id="iconInfo" class="hidden w-8 h-8 text-blue-500" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <!-- 确认图标 -->
                <svg id="iconConfirm" class="hidden w-8 h-8 text-[var(--primary)]" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <!-- 标题 -->
            <h3 id="adminModalTitle" class="text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2"></h3>
            <!-- 消息 -->
            <p id="adminModalMessage" class="text-zinc-600 dark:text-zinc-400 text-sm"></p>
            <div id="adminModalInputWrapper" class="mt-4 hidden">
                <input
                        id="adminModalInput"
                        type="text"
                        class="w-full px-4 py-2.5 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 text-zinc-900 dark:text-zinc-100 focus:ring-2 focus:ring-[var(--primary)] outline-none"
                        placeholder=""
                />
            </div>
        </div>
        <!-- 按钮区域 -->
        <div id="adminModalButtons" class="px-6 pb-6 flex gap-3 justify-center">
            <button id="adminModalCancel"
                    class="hidden px-5 py-2.5 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-xl transition-colors font-medium">
                取消
            </button>
            <button id="adminModalConfirm"
                    class="px-5 py-2.5 bg-[var(--primary)] text-white rounded-xl hover:opacity-90 transition-all font-medium min-w-[80px]">
                确定
            </button>
        </div>
    </div>
</div>

<!-- 修改密码弹框 -->
<div id="changePwModal"
     class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4 backdrop-blur-sm">
    <div class="bg-white dark:bg-zinc-900 rounded-2xl w-full max-w-md shadow-2xl transform transition-all scale-95 opacity-0"
         id="changePwModalContent">
        <div class="p-6 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center">
            <h3 class="text-lg font-bold text-zinc-900 dark:text-zinc-100">修改密码</h3>
            <button id="closeChangePwBtn" class="text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                     stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div class="p-6">
            <form id="globalChangePasswordForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">当前密码 *</label>
                    <div class="relative">
                        <input type="password" id="globalCurrentPassword" required
                               class="w-full px-4 py-2.5 pr-12 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 focus:ring-2 focus:ring-[var(--primary)] outline-none"
                               placeholder="请输入当前密码"/>
                        <button type="button" class="admin-password-toggle" data-target="globalCurrentPassword">
                            <svg class="eye-open h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <svg class="eye-closed h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">新密码 *</label>
                    <div class="relative">
                        <input type="password" id="globalNewPassword" required
                               class="w-full px-4 py-2.5 pr-12 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 focus:ring-2 focus:ring-[var(--primary)] outline-none"
                               placeholder="请输入新密码（至少6位）"/>
                        <button type="button" class="admin-password-toggle" data-target="globalNewPassword">
                            <svg class="eye-open h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <svg class="eye-closed h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-2">确认新密码 *</label>
                    <div class="relative">
                        <input type="password" id="globalConfirmPassword" required
                               class="w-full px-4 py-2.5 pr-12 rounded-xl border border-zinc-200 dark:border-zinc-700 bg-zinc-50 dark:bg-zinc-800 focus:ring-2 focus:ring-[var(--primary)] outline-none"
                               placeholder="请再次输入新密码"/>
                        <button type="button" class="admin-password-toggle" data-target="globalConfirmPassword">
                            <svg class="eye-open h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                            </svg>
                            <svg class="eye-closed h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="flex justify-end pt-2">
                    <button type="button" id="cancelChangePwBtn"
                            class="mr-3 px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-lg transition-colors">
                        取消
                    </button>
                    <button type="submit"
                            class="px-6 py-2 bg-[var(--primary)] text-white rounded-lg hover:opacity-90 transition-opacity shadow-lg">
                        保存修改
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>



<script>
    import { initAdminCore } from "../scripts/admin-core";
    import { initAdminTabs } from "../scripts/admin-tabs";
    import { initAdminUI } from "../scripts/admin-ui";
    import { initAdminPages } from "../scripts/admin-pages";

    // 初始化核心功能
    initAdminCore();
    // 初始化 UI 交互
    initAdminUI();
    // 初始化标签页系统
    initAdminTabs();
    // 初始化特定页面逻辑
    initAdminPages();
</script>
</body>
</html>
